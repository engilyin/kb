"use strict";(self.webpackChunkalex_ilin_kb=self.webpackChunkalex_ilin_kb||[]).push([[4050],{3317:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var c=s(4848),t=s(8453);const r={},o="GCP cheat sheet",i={id:"Cloud/GCP/gcp",title:"GCP cheat sheet",description:"Current config",source:"@site/docs/Cloud/GCP/gcp.md",sourceDirName:"Cloud/GCP",slug:"/Cloud/GCP/",permalink:"/kb/Cloud/GCP/",draft:!1,unlisted:!1,editUrl:"https://github.com/engilyin/kb/docs/Cloud/GCP/gcp.md",tags:[],version:"current",lastUpdatedAt:1727544268e3,frontMatter:{},sidebar:"defaultSidebar",previous:{title:"AWS",permalink:"/kb/Cloud/AWS/"},next:{title:"GCS Bucket",permalink:"/kb/Cloud/GCP/gcp-bucket"}},l={},d=[{value:"Current config",id:"current-config",level:2},{value:"Upload file on bucket under the Service Account",id:"upload-file-on-bucket-under-the-service-account",level:2},{value:"Set another project",id:"set-another-project",level:2},{value:"Run enter VM through the ssh",id:"run-enter-vm-through-the-ssh",level:2},{value:"List of instances and disks",id:"list-of-instances-and-disks",level:2},{value:"delete instance",id:"delete-instance",level:2},{value:"ssh tunel",id:"ssh-tunel",level:2},{value:"copy files from VM",id:"copy-files-from-vm",level:2},{value:"How to set the Windows VM password on higher envs.",id:"how-to-set-the-windows-vm-password-on-higher-envs",level:2},{value:"Service accounts",id:"service-accounts",level:2},{value:"Set permissions on the bucket",id:"set-permissions-on-the-bucket",level:2},{value:"Connect to VM via SSH",id:"connect-to-vm-via-ssh",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"gcp-cheat-sheet",children:"GCP cheat sheet"})}),"\n",(0,c.jsx)(n.h2,{id:"current-config",children:"Current config"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud init\r\n\r\ngcloud config list\r\n\r\ngcloud config set compute/region us-west1\n"})}),"\n",(0,c.jsx)(n.h2,{id:"upload-file-on-bucket-under-the-service-account",children:"Upload file on bucket under the Service Account"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud auth activate-service-account --key-file /path/to/sa-key.json\r\ngsutil ls gs://testbucket\r\ngsutil cp file gs://testbucket/ \n"})}),"\n",(0,c.jsx)(n.p,{children:"E.g."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gsutil cp somejar-2.0.1.jar gs://app-dev-file-exchange/clp-pdf-service/\r\n\n"})}),"\n",(0,c.jsx)(n.h2,{id:"set-another-project",children:"Set another project"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud config set project desired-project-id-here\n"})}),"\n",(0,c.jsx)(n.h2,{id:"run-enter-vm-through-the-ssh",children:"Run enter VM through the ssh"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud compute ssh vmname --internal-ip\n"})}),"\n",(0,c.jsx)(n.p,{children:"Sometimes you may need:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"sudo gcloud compute config-ssh\n"})}),"\n",(0,c.jsx)(n.h2,{id:"list-of-instances-and-disks",children:"List of instances and disks"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"\r\ngcloud compute instances list\r\n\r\ngcloud compute disks list\r\n\n"})}),"\n",(0,c.jsx)(n.h2,{id:"delete-instance",children:"delete instance"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud compute instances delete example-instance\n"})}),"\n",(0,c.jsx)(n.h2,{id:"ssh-tunel",children:"ssh tunel"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud compute ssh vmname -- -L 10000:10.46.176.244:1525\r\n\r\n#to rdp onto the Windows VM\r\ngcloud compute ssh jumpbox --internal-ip -- -L 10005:10.39.32.204:3389\r\n\n"})}),"\n",(0,c.jsx)(n.h2,{id:"copy-files-from-vm",children:"copy files from VM"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"\r\ngcloud compute scp vmname:tmp.tar.bz2 C:\\Users\\MyHome\\tmp\\ --internal-ip\r\n\n"})}),"\n",(0,c.jsx)(n.h2,{id:"how-to-set-the-windows-vm-password-on-higher-envs",children:"How to set the Windows VM password on higher envs."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"gcloud auth activate-service-account --key-file <key.json>\r\ngcloud auth list\r\n\r\n#wrong?\r\n#gcloud beta compute -project \"prj\" -reset-windows-password 'dsfdf' -zone us-west1-a -user admin\r\n\r\n#from doc\r\ngcloud beta compute reset-windows-password my-instance  --zone=us-central1-f --user=foo\r\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"do not use Administrator it is not allowed by company policy"}),"\n",(0,c.jsx)(n.h2,{id:"service-accounts",children:"Service accounts"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'gcloud iam service-accounts add-iam-policy-binding ${gsa_email} --role roles/iam.workloadIdentityUser --member "serviceAccount:${kf_project}.svc.id.goog[${brokerspace}/sa-${brokername}]" --project=$kf_project  # to set workload identity in that service account\n'})}),"\n",(0,c.jsx)(n.h2,{id:"set-permissions-on-the-bucket",children:"Set permissions on the bucket"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"#grant full access\r\ngsutil acl ch -u username@domain.com:O gs://example-bucket\r\n\r\n#remove access\r\ngsutil acl ch -d john.doe@example.com gs://example-bucket\r\n\r\n#get info\r\ngsutil acl get gs://example-bucket\n"})}),"\n",(0,c.jsxs)(n.p,{children:["or to see on ",(0,c.jsx)(n.code,{children:"Permissions"})," tab"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"gsutil iam ch serviceAccount:service-account@domain.com:roles/storage.admin  gs://example-bucket\r\ngsutil iam ch user:username@domain.com:roles/storage.admin  gs://example-bucket\n"})}),"\n",(0,c.jsx)(n.h2,{id:"connect-to-vm-via-ssh",children:"Connect to VM via SSH"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Create the ssh key"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'ssh-keygen -C "username@domain.com"\r\n\n'})}),"\n",(0,c.jsxs)(n.ol,{start:"2",children:["\n",(0,c.jsx)(n.li,{children:"Add the public key to VM"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"gcloud compute instances add-metadata <vm-name> --metadata-from-file ssh-keys=./my.key.pub\n"})}),"\n",(0,c.jsx)(n.p,{children:"Add external IP:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"gcloud compute instances add-access-config ciswebwdavmsb-5b --access-config-name=scp-acces\r\n\n"})}),"\n",(0,c.jsxs)(n.ol,{start:"2",children:["\n",(0,c.jsx)(n.li,{children:"Register it on the VM. Use impersonation if needed"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,c.jsx)(n.p,{children:"In case of encoding error from the Python stack trace try to set this env var:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"set PYTHONIOENCODING=UTF-8\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>i});var c=s(6540);const t={},r=c.createContext(t);function o(e){const n=c.useContext(r);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),c.createElement(r.Provider,{value:n},e.children)}}}]);