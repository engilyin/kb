"use strict";(self.webpackChunkalex_ilin_kb=self.webpackChunkalex_ilin_kb||[]).push([[4023],{7376:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"Tools/docker","title":"Docker commands and useful stuff","description":"Start Docker on Mac (Using minicube)","source":"@site/docs/Tools/docker.md","sourceDirName":"Tools","slug":"/Tools/docker","permalink":"/kb/Tools/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/engilyin/kb/docs/Tools/docker.md","tags":[],"version":"current","lastUpdatedAt":1727544268000,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"Tools","permalink":"/kb/category/tools"},"next":{"title":"Git sheat sheet","permalink":"/kb/Tools/git"}}');var o=r(4848),t=r(8453);const i={},c="Docker commands and useful stuff",d={},l=[{value:"Start Docker on Mac (Using minicube)",id:"start-docker-on-mac-using-minicube",level:2},{value:"To run",id:"to-run",level:3},{value:"To install it you would need:",id:"to-install-it-you-would-need",level:3},{value:"GCP",id:"gcp",level:2},{value:"Docker file",id:"docker-file",level:2},{value:"Compose file",id:"compose-file",level:2},{value:"Command to run docker compose",id:"command-to-run-docker-compose",level:2},{value:"See the logs:",id:"see-the-logs",level:2},{value:"run RabbitMQ in docker",id:"run-rabbitmq-in-docker",level:2},{value:"run Redis",id:"run-redis",level:2},{value:"stat",id:"stat",level:2},{value:"network",id:"network",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"docker-commands-and-useful-stuff",children:"Docker commands and useful stuff"})}),"\n",(0,o.jsx)(n.h2,{id:"start-docker-on-mac-using-minicube",children:"Start Docker on Mac (Using minicube)"}),"\n",(0,o.jsx)(n.h3,{id:"to-run",children:"To run"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'# Start minikube\r\nminikube start\r\n\r\n# Tell Docker CLI to talk to minikube\'s VM\r\neval $(minikube docker-env)\r\n\r\n# Save IP to a hostndockr buildame\r\necho "`minikube ip` docker.local" | sudo tee -a /etc/hosts > /dev/null\n'})}),"\n",(0,o.jsx)(n.h3,{id:"to-install-it-you-would-need",children:"To install it you would need:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# Install hyperkit and minikube\r\nbrew install hyperkit\r\nbrew install minikube\r\n\r\n# Install Docker CLI\r\nbrew install docker\r\nbrew install docker-compose\r\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"And"}),"\n",(0,o.jsx)(n.h3,{id:""}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"minikube stop"})," - stop the VM and k8s cluster. This does not delete any data. Just run minikube start to spin up the cluster."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"minikube delete"})," - This deletes the cluster with all the data. All mapped volumes will be lost. Know what you're doing before running this. If you just want to stop the cluster use minikube stop."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"minikube ip"})," - IP address of the VM where the cluster and docker engine run."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"minikube pause"})," - to pause k8s related containers so they do not end up consuming system resources. ",(0,o.jsx)(n.code,{children:"minikube"})," runs a k8s setup and thus runs a lot of containers that are not required if not using k8s. We can run this command to save resources."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"gcp",children:"GCP"}),"\n",(0,o.jsx)(n.p,{children:"To uthenticate on the private registry:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'docker login -u _token -p "$(gcloud auth print-access-token)" https://us.gcr.io\n'})}),"\n",(0,o.jsx)(n.h2,{id:"docker-file",children:"Docker file"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'\r\nFROM linuxserver/code-server:latest \r\n\r\n\r\n \r\n\r\nUSER root\r\n\r\n\r\n \r\n\r\nRUN   curl -L "https://github.com/docker/compose/releases/download/1.23.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose \\\r\n\r\n    && chmod +x /usr/local/bin/docker-compose \\\r\n\r\n   && docker-compose --version \\\r\n\r\n   && apt-get update && apt-get -y install apt-transport-https vim ca-certificates curl gnupg2 software-properties-common && curl -fsSL https://download.docker.com/linux/$(. /etc/os-release; echo "$ID")/gpg > /tmp/dkey; apt-key add /tmp/dkey && add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/$(. /etc/os-release; echo "$ID") \\\r\n\r\n   $(lsb_release -cs) \\\r\n\r\n   stable" && apt-get update && apt-get -y install docker-ce  \\\r\n\r\n   && apt install -y openjdk-8-jdk \r\n\r\nRUN     curl -sL https://deb.nodesource.com/setup_10.x | bash - && \\\r\n\r\n        apt-get install gcc g++ make nodejs -y && \\\r\n\r\n        curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - && \\\r\n\r\n        echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list && \\\r\n\r\n        apt-get update && apt-get -y install yarn\r\n        \n'})}),"\n",(0,o.jsx)(n.h2,{id:"compose-file",children:"Compose file"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'cat docker-compose.yml \r\n\r\n---\r\n\r\nversion: "2.1"\r\n\r\nservices:\r\n\r\n  code-server:\r\n\r\n    build:\r\n\r\n      context: ./payment-service\r\n\r\n      dockerfile: Dockerfile.code\r\n\r\n    container_name: code-server\r\n\r\n    environment:\r\n\r\n      - PUID=1000\r\n\r\n      - PGID=1000\r\n\r\n      - TZ=Europe/London\r\n\r\n      - PASSWORD=password #optional\r\n\r\n      - SUDO_PASSWORD=password #optional\r\n\r\n#    volumes:\r\n\r\n#      - ./payment-service:/config/workspace/payment-service\r\n\r\n    ports:\r\n\r\n      - 8443:8443\r\n\r\n      - 8080:8080\r\n\r\n    restart: unless-stopped\r\n    \n'})}),"\n",(0,o.jsx)(n.h2,{id:"command-to-run-docker-compose",children:"Command to run docker compose"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"\r\ndocker-compose --file docker-compose.yml up --build -d\r\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"see-the-logs",children:"See the logs:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"\r\ndocker logs che-server\r\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"run-rabbitmq-in-docker",children:"run RabbitMQ in docker"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management\n"})}),"\n",(0,o.jsx)(n.h2,{id:"run-redis",children:"run Redis"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"docker run -it --rm -p 6379:6379 --name redis1 redis\r\n\r\ndocker exec -it redis1 sh\r\nredis-cli\r\n\r\nFLUSHALL\r\nKEYS *\r\nDUMP spring:session:sessions:a7235355-5ebb-4800-b777-95d9b1512345\n"})}),"\n",(0,o.jsx)(n.h2,{id:"stat",children:"stat"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"docker stat\n"})}),"\n",(0,o.jsx)(n.h2,{id:"network",children:"network"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' container_name_or_id\r\n\r\ndocker exec container_name_or_id cat /etc/hosts \r\n\r\ndocker inspect\r\n\r\ndocker builder prune\r\n\r\ndocker system prune\n"})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>c});var s=r(6540);const o={},t=s.createContext(o);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);