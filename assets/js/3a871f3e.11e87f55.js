"use strict";(self.webpackChunkalex_ilin_kb=self.webpackChunkalex_ilin_kb||[]).push([[5885],{9516:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"DevOps/jenkins","title":"Jenkins","description":"Call cf command","source":"@site/docs/DevOps/jenkins.md","sourceDirName":"DevOps","slug":"/DevOps/jenkins","permalink":"/kb/DevOps/jenkins","draft":false,"unlisted":false,"editUrl":"https://github.com/engilyin/kb/docs/DevOps/jenkins.md","tags":[],"version":"current","lastUpdatedAt":1727544268000,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"CI/CD","permalink":"/kb/DevOps/cicd"},"next":{"title":"Terraform","permalink":"/kb/DevOps/terraform"}}');var s=e(4848),a=e(8453);const i={},o="Jenkins",c={},l=[{value:"Call cf command",id:"call-cf-command",level:2},{value:"Touch the endpoint",id:"touch-the-endpoint",level:2}];function p(t){const n={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,a.R)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"jenkins",children:"Jenkins"})}),"\n",(0,s.jsx)(n.h2,{id:"call-cf-command",children:"Call cf command"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-groovy",children:'\r\n#!groovy\r\n\r\n\r\n\r\ndef login(url, org, space){\r\n\r\nwithCredentials([usernamePassword(credentialsId: env.CredsToUse, usernameVariable: \'uName\', passwordVariable: \'password\')]) {\r\n\tCONNECT = sh (\r\n\t\t\t\tscript: "cf login -a ${url} -u \\"${uName}\\" -p \\"${password}\\" -o ${org} -s ${space}",\r\n\t\t\t\treturnStatus: true\r\n\t\t\t)\r\n\tsh """\r\n\t\t${env.PCF_COMMAND}\r\n\t\t"""\r\n}\r\n}\r\n\r\nansiColor(\'xterm\') {\r\n\r\nnode {\r\n\ttimeout(time: 30, unit: \'MINUTES\') {\r\n\r\n\t\tstage(\'Preparation\') {\r\n\t\t\tenv.PATH = "/usr/sbin:$env.PATH"\r\n\t\t\tenv.PATH = "/home/jenkins/bin:$env.PATH"\r\n\t\t\tenv.PATH = "/apps/home/builder/bin:$env.PATH"\r\n\r\n\t\t\tenv.LANG = "en_US.UTF-8"\r\n\t\t\tenv.LC_ALL = "en_US.UTF-8"\r\n\t\t\tenv.LANGUAGE = "en_US.UTF-8"\r\n\r\n\t\t\tdef regionUrlFragment;\r\n\t\t\tswitch(params.gcpRegion){\r\n\t\t\t\tcase "us-central-1":\r\n\t\t\t\t\tregionUrlFragment = \'usc1\'\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase "us-west-1":\r\n\t\t\t\t\tregionUrlFragment = \'usw1\'\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tenv.PCF_API =  params.pcfApiEndpoint\r\n\t\t\tenv.PCF_ORG = params.pcfOrg\r\n\t\t\tenv.PCF_SPACE = params.pcfSpace\r\n\t\t\tenv.PCF_APP = params.pcfApp\r\n\t\t\tenv.PCF_COMMAND = params.pcfCommand\r\n\t\t}\r\n\t\t// stage(\'Approve Route Changes\'){\r\n\t\t//   input \'Please approve ClareityIAM Route management in production\'\r\n\t\t// }\r\n\t\tstage(\'Exec\')\r\n\t\t{\r\n\t\t\t\tlogin(env.PCF_API, env.PCF_ORG, env.PCF_SPACE)\r\n\r\n\t\t}\r\n\r\n\t}\r\n}\r\n}\r\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"touch-the-endpoint",children:"Touch the endpoint"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-groovy",children:"    stage('Stage 2') {\r\n      steps {\r\n        timeout(time: 1, unit: 'MINUTES') {\r\n          waitUntil {\r\n            script {\r\n              echo 'This stage should succeed immediately if google.com is up, otherwise jenkins will retry until 1min runs out.'\r\n              def status = sh script: 'wget -q https://google.com -O /dev/null', returnStatus: true\r\n              return (status == 0)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\n"})})]})}function d(t={}){const{wrapper:n}={...(0,a.R)(),...t.components};return n?(0,s.jsx)(n,{...t,children:(0,s.jsx)(p,{...t})}):p(t)}},8453:(t,n,e)=>{e.d(n,{R:()=>i,x:()=>o});var r=e(6540);const s={},a=r.createContext(s);function i(t){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function o(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:i(t.components),r.createElement(a.Provider,{value:n},t.children)}}}]);