"use strict";(self.webpackChunkalex_ilin_kb=self.webpackChunkalex_ilin_kb||[]).push([[7777],{1237:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var r=t(4848),i=t(8453);const a={},s=void 0,o={id:"Job/TechInterview/Java/core/jvm-internals",title:"jvm-internals",description:"JVM Internals",source:"@site/docs/Job/TechInterview/Java/core/jvm-internals.md",sourceDirName:"Job/TechInterview/Java/core",slug:"/Job/TechInterview/Java/core/jvm-internals",permalink:"/kb/Job/TechInterview/Java/core/jvm-internals",draft:!1,unlisted:!1,editUrl:"https://github.com/engilyin/kb/docs/Job/TechInterview/Java/core/jvm-internals.md",tags:[],version:"current",lastUpdatedAt:1727972934e3,frontMatter:{},sidebar:"defaultSidebar",previous:{title:"java-memory-model",permalink:"/kb/Job/TechInterview/Java/core/java-memory-model"},next:{title:"approach",permalink:"/kb/Job/TechInterview/Java/design/approach"}},l={},c=[{value:"JVM Internals",id:"jvm-internals",level:2},{value:"Compressed pointers",id:"compressed-pointers",level:3},{value:"String interning",id:"string-interning",level:3},{value:"Thread Affinity",id:"thread-affinity",level:3},{value:"Other topics",id:"other-topics",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"jvm-internals",children:"JVM Internals"}),"\n",(0,r.jsx)(n.p,{children:"Some of the topics listed below are tricks JVM uses to improve performance. Subset of these can be exploited to further improve\napplication performance."}),"\n",(0,r.jsx)(n.p,{children:"Note: These topics are highly unlikely to come up in an interview. Feel free to just glance through without digging deep."}),"\n",(0,r.jsx)(n.h3,{id:"compressed-pointers",children:"Compressed pointers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"32 bit references can address 4GB, while 64 bit can reference 2^64 bytes (though limited by OS/RAM on the machine)."}),"\n",(0,r.jsxs)(n.li,{children:["Having 64 bit reference for every object increases memory usage. JVMs use ",(0,r.jsx)(n.a,{href:"https://wiki.openjdk.java.net/display/HotSpot/CompressedOops",children:"compressed pointers"})," to address this issue."]}),"\n",(0,r.jsx)(n.li,{children:"Basic idea is to store 32-bits per reference and then add to a base address to find final 64-bit address."}),"\n",(0,r.jsxs)(n.li,{children:["Flag: ",(0,r.jsx)(n.code,{children:"-XX:+UseCompressedOops"}),". Latest versions of 64-bit Java have this argument by default."]}),"\n",(0,r.jsx)(n.li,{children:"Addresses upto 4gb untranslated."}),"\n",(0,r.jsx)(n.li,{children:"Addresses 4gb to 28gb, remove 3bits, because Java has 8 byte word aligned, thus 3 bits need not be stored."}),"\n",(0,r.jsx)(n.li,{children:"Important because Java has more references. In C++ memory layout follows struct layout."}),"\n",(0,r.jsxs)(n.li,{children:["Java 8 has JVM args, ",(0,r.jsx)(n.code,{children:"+XX:ObjectAlignmentInBytes=16"})," for heap between 32gb and 64gb."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"string-interning",children:"String interning"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Interning = storing strings in a pool and re-using them"}),"\n",(0,r.jsx)(n.li,{children:"If you intern a set of all strings, you can compare them by == improving performance."}),"\n",(0,r.jsx)(n.li,{children:"It is stored internally as a hashmap (it is native C code, not Java code)."}),"\n",(0,r.jsxs)(n.li,{children:["More details ",(0,r.jsx)(n.a,{href:"http://java-performance.info/string-intern-in-java-6-7-8/",children:"here"})," and ",(0,r.jsx)(n.a,{href:"http://java-performance.info/changes-to-string-java-1-7-0_06/",children:"here"})]}),"\n",(0,r.jsx)(n.li,{children:"How would you implement your own string interning?"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Java",children:"private static final WeakHashMap<String, WeakReference<String>> s_manualCache\n      = new WeakHashMap<String, WeakReference<String>>(100000);\n \nprivate static String manualIntern(final String str){\n    final WeakReference<String> cached = s_manualCache.get(str);\n    if (cached != null){\n        final String value = cached.get();\n        if (value != null)\n            return value;\n    }\n    s_manualCache.put(str, new WeakReference<String>(str));\n    return str;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"thread-affinity",children:"Thread Affinity"}),"\n",(0,r.jsx)(n.p,{children:"Makes the thread stick to a CPU core, even if it has no tasks left to perform. Unlike normal threads, this won't go into sleep/wait.\nThread performs busy-spin. Note: This is wasting of CPU resources, and it can lead to thread starvation since other threads\ndo not get access to that core. Thus, it needs to be used for the right applications. Helpful in latency critical applications like FX Trading."}),"\n",(0,r.jsxs)(n.p,{children:["Thread affinity only works for Linux and there are ",(0,r.jsx)(n.a,{href:"https://github.com/OpenHFT/Java-Thread-Affinity",children:"Java libraries available"})," to use the same"]}),"\n",(0,r.jsx)(n.h3,{id:"other-topics",children:"Other topics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://srvaroa.github.io/jvm/java/openjdk/biased-locking/2017/01/30/hashCode.html",children:"How does default hashCode method work?"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://blogs.oracle.com/dave/entry/biased_locking_in_hotspot",children:"What is Biased locking"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"http://openjdk.java.net/groups/hotspot/docs/RuntimeOverview.html#Thread%20Management%7Coutline",children:"JVM Threads link with OS threads"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://zeroturnaround.com/rebellabs/rebel-labs-tutorial-do-you-really-get-classloaders/",children:"Class Loaders"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"http://java-performance.info/overview-of-memory-saving-techniques-java/",children:"Memory consumptions of primitives and boxed variables"})}),"\n",(0,r.jsxs)(n.li,{children:["Hoisting variables: JVM can hoist variables out of for loops to improve performance. ",(0,r.jsx)(n.a,{href:"http://stackoverflow.com/a/9338302/3494368",children:"example"})]}),"\n",(0,r.jsx)(n.li,{children:"Escape analysis: JVM can choose to place a method local object (if it never escapes the method) in Thread-stack instead of heap.\nImproves performance since that object doesn't go through GC (can be just deleted once method completes)."}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var r=t(6540);const i={},a=r.createContext(i);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);