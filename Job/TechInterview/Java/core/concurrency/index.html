<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Job/TechInterview/Java/core/concurrency" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">concurrency | Alex Ilin Knowledge Base</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://engilyin.github.com/kb/Job/TechInterview/Java/core/concurrency"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="concurrency | Alex Ilin Knowledge Base"><meta data-rh="true" name="description" content="Concurrency"><meta data-rh="true" property="og:description" content="Concurrency"><link data-rh="true" rel="icon" href="/kb/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://engilyin.github.com/kb/Job/TechInterview/Java/core/concurrency"><link data-rh="true" rel="alternate" href="https://engilyin.github.com/kb/Job/TechInterview/Java/core/concurrency" hreflang="en"><link data-rh="true" rel="alternate" href="https://engilyin.github.com/kb/Job/TechInterview/Java/core/concurrency" hreflang="x-default"><link rel="stylesheet" href="/kb/assets/css/styles.41438659.css">
<script src="/kb/assets/js/runtime~main.dda16436.js" defer="defer"></script>
<script src="/kb/assets/js/main.213222c6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/kb/"><div class="navbar__logo"><img src="/kb/img/logo.jpg" alt="Alex Ilin KB Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/kb/img/logo.jpg" alt="Alex Ilin KB Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Alex Ilin Knowledge Base</b></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div><a href="https://github.com/engilyin/kb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kb/">Alex Ilin Knowledge Base</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/kb/AI/basics">AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/kb/Cloud/AWS/">Cloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kb/category/databases">Databases</a><button aria-label="Expand sidebar category &#x27;Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kb/category/devops">DevOps</a><button aria-label="Expand sidebar category &#x27;DevOps&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kb/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/kb/category/job">Job</a><button aria-label="Collapse sidebar category &#x27;Job&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/kb/category/interview">Interview</a><button aria-label="Collapse sidebar category &#x27;Interview&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/kb/Job/TechInterview/Java/">Java Tech Interview</a><button aria-label="Collapse sidebar category &#x27;Java Tech Interview&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/kb/Job/TechInterview/Java/core/collections">core</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/Java/core/collections">collections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kb/Job/TechInterview/Java/core/concurrency">concurrency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/Java/core/core-java">core-java</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/Java/core/garbage-collection">garbage-collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/Java/core/java-8">java-8</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/Java/core/java-memory-model">java-memory-model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/Java/core/jvm-internals">jvm-internals</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/kb/Job/TechInterview/Java/design/approach">design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/kb/Job/TechInterview/Java/opinion/myanswers">opinion</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/kb/Job/TechInterview/Java/problem-solving/common-coding-problems">problem-solving</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/kb/Job/TechInterview/Java/related/sql">related</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/kb/Job/TechInterview/Java/spring/aop">spring</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/complexity">Complexity: Big O Notation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/db-tech-interview">Tech Interview DB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kb/Job/TechInterview/devops-tech-interview">Tech Interview DevOps</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/kb/Network/networking">Network</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kb/category/sre">SRE</a><button aria-label="Expand sidebar category &#x27;SRE&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kb/category/software-architecture">Software Architecture</a><button aria-label="Expand sidebar category &#x27;Software Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/kb/category/tools">Tools</a><button aria-label="Expand sidebar category &#x27;Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/kb/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/kb/category/job"><span itemprop="name">Job</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/kb/category/interview"><span itemprop="name">Interview</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/kb/Job/TechInterview/Java/"><span itemprop="name">Java Tech Interview</span></a><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">core</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">concurrency</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>concurrency</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="concurrency">Concurrency<a href="#concurrency" class="hash-link" aria-label="Direct link to Concurrency" title="Direct link to Concurrency">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a href="#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h3>
<ul>
<li><a href="http://jcip.net" target="_blank" rel="noopener noreferrer">Concurrency in Practice by Brian Goetz</a> - Highly Recommended</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table of Contents<a href="#table-of-contents" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents">​</a></h3>
<ul>
<li><a href="#basics">Basics</a>
<ul>
<li><a href="#benefits-of-threads">Benefits of Threads</a></li>
<li><a href="#thread-safety">Thread safety</a></li>
<li><a href="#race-condition">Race Condition</a></li>
<li><a href="#solutions-to-compound-operations">Solutions to compound operations</a></li>
<li><a href="#synchronized">Synchronized</a></li>
<li><a href="#liveness-and-performance">Liveness and Performance</a></li>
</ul>
</li>
<li><a href="#sharing-objects">Sharing Objects</a>
<ul>
<li><a href="#data-visibility">Data Visibility</a></li>
<li><a href="#safe-construction">Safe construction</a></li>
<li><a href="#confinement">Confinement</a></li>
<li><a href="#immutability">Immutability</a></li>
<li><a href="#final-fields">Final Fields</a></li>
<li><a href="#safe-publishing">Safe Publishing</a></li>
</ul>
</li>
<li><a href="#composing-objects">Composing Objects</a>
<ul>
<li><a href="#state-ownership">State Ownership</a></li>
<li><a href="#unmodifiable">Unmodifiable</a></li>
<li><a href="#client-side-locking">Client-side locking</a></li>
</ul>
</li>
<li><a href="#building-blocks">Building Blocks</a>
<ul>
<li><a href="#iterators-and-concurrentmodificationexception">Iterators and ConcurrentModificationException</a></li>
<li><a href="#concurrent-collections">Concurrent Collections</a></li>
<li><a href="#interruptedexception">InterruptedException</a></li>
<li><a href="#synchronizers">Synchronizers</a></li>
</ul>
</li>
<li><a href="#task-execution">Task Execution</a>
<ul>
<li><a href="#thread-pools">Thread Pools</a></li>
<li><a href="#uncaught-exception-handlers">Uncaught exception handlers</a></li>
<li><a href="#shutdown-hooks">Shutdown hooks</a></li>
<li><a href="#daemon-threads">Daemon threads</a></li>
<li><a href="#finalizers">Finalizers</a></li>
</ul>
</li>
<li><a href="#applying-thread-pools">Applying Thread Pools</a>
<ul>
<li><a href="#thread-pool-sizes">Thread pool sizes</a></li>
<li><a href="#threadpoolexecutor">ThreadPoolExecutor</a></li>
<li><a href="#threads">Threads</a></li>
<li><a href="#task-queues">Task Queues</a></li>
<li><a href="#saturation-policy">Saturation Policy</a></li>
<li><a href="#thread-factory">Thread Factory</a></li>
</ul>
</li>
<li><a href="#avoiding-liveness-hazards">Avoiding Liveness Hazards</a>
<ul>
<li><a href="#deadlocks">Deadlocks</a></li>
<li><a href="#starvation-and-livelock">Starvation and LiveLock</a></li>
</ul>
</li>
<li><a href="#performance-and-scalability">Performance and Scalability</a>
<ul>
<li><a href="#costs-on-performance">Costs on performance</a></li>
<li><a href="#steps">Steps</a></li>
</ul>
</li>
<li><a href="#explicit-locks">Explicit Locks</a>
<ul>
<li><a href="#lock-and-reentrantlock">Lock and ReentrantLock</a></li>
<li><a href="#advantages-of-lock-classes">Advantages of lock classes</a></li>
<li><a href="#read-write-lock">Read-Write lock</a></li>
<li><a href="#custom-synchronizer">Custom Synchronizer</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basics">Basics<a href="#basics" class="hash-link" aria-label="Direct link to Basics" title="Direct link to Basics">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="benefits-of-threads">Benefits of Threads<a href="#benefits-of-threads" class="hash-link" aria-label="Direct link to Benefits of Threads" title="Direct link to Benefits of Threads">​</a></h4>
<ul>
<li>Exploiting multiple processors (Resource utilization) - Increasing core counts</li>
<li>Simplicity of modeling applications - Distinct tasks can have own thread, and each can be written sequentially.</li>
<li>Simplified handling of asynchronous events - If thread is blocked on IO, other threads  can still run. Though these days OS allow 100s of thousands of threads, so blocking is not a major issuer anymore. Thus NIO is not as crucial anymore (because its very complicated to implement).</li>
</ul>
<p>Even if your class doesn&#x27;t use threads, these do</p>
<ul>
<li>Underlying frameworks</li>
<li>RMI</li>
<li>JVM (for GC + Main)</li>
<li>Timer</li>
<li>Servlets &amp; JSP</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="thread-safety">Thread safety<a href="#thread-safety" class="hash-link" aria-label="Direct link to Thread safety" title="Direct link to Thread safety">​</a></h4>
<p>Correctness means that a class <em>conforms to its specification</em>. A good specification defines <em>invariants</em> constraining an object&#x27;s state and <em>postconditions</em> describing the effects of its operations.</p>
<p><em>No set of operations performed sequentially or concurrently on instances of a thread-safe class can cause an instance to be in an invalid state.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="race-condition">Race Condition<a href="#race-condition" class="hash-link" aria-label="Direct link to Race Condition" title="Direct link to Race Condition">​</a></h4>
<ul>
<li>A race condition occurs when the correctness of a computation depends on the relative timing or interleaving of multiple threads by the runtime</li>
<li>Occurs usually with <em>check-then-act</em> (check stale value). Eg: Lazy initialization.</li>
<li>Data races is different than race condition. Data races is when thread access (read/write) data to variable without any synchronization.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="solutions-to-compound-operations">Solutions to compound operations<a href="#solutions-to-compound-operations" class="hash-link" aria-label="Direct link to Solutions to compound operations" title="Direct link to Solutions to compound operations">​</a></h4>
<ul>
<li>Atomic classes (if only single variable is the issue)</li>
<li>Synchronized (if multiple variables are to be updated atomically)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="synchronized">Synchronized<a href="#synchronized" class="hash-link" aria-label="Direct link to Synchronized" title="Direct link to Synchronized">​</a></h4>
<ul>
<li>Aka Intrinsic locks, Mutexes, monitors</li>
<li>Are re-entrant</li>
<li>Re-entrancy can help for overridden synchronized methods. Call to super.method() tries to re-acquire lock, and is permitted.</li>
</ul>
<p>Allowing Object class to act as a lock (instead of special classes) was a mistake in JVM design. JVM implementors now have to make trade offs between object size and locking performance.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="liveness-and-performance">Liveness and Performance<a href="#liveness-and-performance" class="hash-link" aria-label="Direct link to Liveness and Performance" title="Direct link to Liveness and Performance">​</a></h4>
<ul>
<li>If scope of synchronized block is too large (say entire method of service). The whole performance benefit of multi-threading might be wiped off if service is accessed by lot of threads.</li>
<li>Scope of synchronized block should be small enough that it covers all mutable state.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sharing-objects">Sharing Objects<a href="#sharing-objects" class="hash-link" aria-label="Direct link to Sharing Objects" title="Direct link to Sharing Objects">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-visibility">Data Visibility<a href="#data-visibility" class="hash-link" aria-label="Direct link to Data Visibility" title="Direct link to Data Visibility">​</a></h4>
<ul>
<li>When data is not synchronized, other thread might read stale data (due to caching of variables in CPU registers and L1, L2)</li>
<li>64-bit operations can be treated as 2 32-bit operations, thus need to be synchronized</li>
<li>Synchronized keyword ensures other thread reads latest data</li>
<li>Volatile keyword does the same</li>
<li>Semantics of volatile does not guarantee atomic increment!! Thus use volatile generally as status flags and such.</li>
</ul>
<p>Debugging tip: --server argument can hoist variables out of if condition (due to heavier optimization), while client JVM may not. Thus don&#x27;t just think, if it works in client it works on server.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="safe-construction">Safe construction<a href="#safe-construction" class="hash-link" aria-label="Direct link to Safe construction" title="Direct link to Safe construction">​</a></h4>
<p>Do not let this reference escape the constructor. Even if it is last statement of constructor, the escaped reference of this, may not be pointing to completed object.</p>
<p>Thus instead of constructors, listeners use setListener factory methods.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="confinement">Confinement<a href="#confinement" class="hash-link" aria-label="Direct link to Confinement" title="Direct link to Confinement">​</a></h4>
<p>Confining variables within method is best. For primitives its easy, but for objects, have to ensure its reference is not escaping. Thus Java has Collections.unmodifiableCollection and such.</p>
<p>Note: unmodifiableCollection doesn&#x27;t allow references to be updated, but objects&#x27; can still be updated if they are mutable.  Eg: Map&lt;String, Vehicle&gt;.. Vehicle object can still be updated.</p>
<p>ThreadLocal can also be used if its instance variable, but has to be thread-confined.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="immutability">Immutability<a href="#immutability" class="hash-link" aria-label="Direct link to Immutability" title="Direct link to Immutability">​</a></h4>
<p>Simple. Objects that cannot be modified, there are no threading issues.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="final-fields">Final Fields<a href="#final-fields" class="hash-link" aria-label="Direct link to Final Fields" title="Direct link to Final Fields">​</a></h4>
<p>Guarantee initialization safety.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Holder</span><span class="token plain"> holder</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     holder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Holder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// not guarantee to be done atomically, unless variable is final</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="safe-publishing">Safe Publishing<a href="#safe-publishing" class="hash-link" aria-label="Direct link to Safe Publishing" title="Direct link to Safe Publishing">​</a></h4>
<ul>
<li>Placing a key or value in a Hashtable, synchronizedMap, or Concurrent- Map safely publishes it to any thread that retrieves it from the Map (whether directly or via an iterator);</li>
<li>Placing an element in a Vector, CopyOnWriteArrayList, CopyOnWriteArraySet, synchronizedList, or synchronizedSet safely publishes it to any thread that retrieves it from the collection;</li>
<li>Placing an element on a BlockingQueue or a ConcurrentLinkedQueue safely publishes it to any thread that retrieves it from the queue.</li>
</ul>
<p>Using a static initializer is often the easiest and safest way to publish objects that can be statically constructed:   <em>public static Holder holder = new Holder(42);</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="composing-objects">Composing Objects<a href="#composing-objects" class="hash-link" aria-label="Direct link to Composing Objects" title="Direct link to Composing Objects">​</a></h3>
<p>Making a class thread-safe means ensuring that its invariants hold under concurrent access; this requires reasoning about its state. Objects and variables have a state space: the range of possible states they can take on. The smaller this state space, the easier it is to reason about. By using final fields wherever practical, you make it simpler to analyze the possible states an object can be in. (In the extreme case, immutable objects can only be in a single state.)</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="state-ownership">State Ownership<a href="#state-ownership" class="hash-link" aria-label="Direct link to State Ownership" title="Direct link to State Ownership">​</a></h4>
<p>Owner of the state can help reason about the mutable access. In Java, there can be shared ownership or transferred ownership (since objects are passed as reference).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="unmodifiable">Unmodifiable<a href="#unmodifiable" class="hash-link" aria-label="Direct link to Unmodifiable" title="Direct link to Unmodifiable">​</a></h4>
<p>unmodifiableCollection doesn&#x27;t allow references to be updated, but values themselves can still be updated if they are mutable.  Eg: Map&lt;String, Vehicle&gt;.. Vehicle object can still be updated.</p>
<p>locations = new ConcurrentHashMap&lt;String, Point&gt;(points);</p>
<p>unmodifiableMap = Collections.unmodifiableMap(locations);</p>
<p>unmodifiableMap stores &quot;live&quot; view of the locations map (i.e. any update to locations are reflected in unmodifiableMap).</p>
<p>To just give static view (non-live view) wrap it in new HashMap instance and then in unmodifiable.</p>
<p>Collections.unmodifiableMap(new HashMap&lt;String, Point&gt;(locations));}</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="client-side-locking">Client-side locking<a href="#client-side-locking" class="hash-link" aria-label="Direct link to Client-side locking" title="Direct link to Client-side locking">​</a></h4>
<p>It can be difficult, because client has to lock on same object which the ThreadSafeClass uses. For example creating a putIfAbsent method in List class</p>
<ul>
<li>Cannot be achieved through having separate lock.</li>
<li>Can be achieved using same lock as the list. But here locks are spreads over 2 classes (this and List)</li>
<li>Best is to use composition, where you extend list, and ask clients to use this class.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-blocks">Building Blocks<a href="#building-blocks" class="hash-link" aria-label="Direct link to Building Blocks" title="Direct link to Building Blocks">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="iterators-and-concurrentmodificationexception">Iterators and ConcurrentModificationException<a href="#iterators-and-concurrentmodificationexception" class="hash-link" aria-label="Direct link to Iterators and ConcurrentModificationException" title="Direct link to Iterators and ConcurrentModificationException">​</a></h4>
<p>Iterators are implemented by associating a modification count with the collection: if the modification count changes during iteration, hasNext or next throws ConcurrentModificationException. However, this check is done without synchronization, so there is a risk of seeing a stale value of the modification count and therefore that the iterator does not realize a modification has been made. This was a deliberate design tradeoff to reduce the performance impact of the concurrent modification detection code.</p>
<p>Easiest way to avoid this, is to hold lock on the list/collection during iteration (in client code). This will come at a cost of scalability. This again, can be avoided, by making copy of entire collection (by wrapping in a lock), and then without locking iterating over that cloned collection. But this comes with increased cost of memory &amp; speed (copying collection every time).</p>
<p>There are also hidden iterators, like when you do toString on collection it internally iterates over all elements appending to StringBuilder. In such cases, on client side use the Collection.synchronizedSet() and then perform all operations.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="concurrent-collections">Concurrent Collections<a href="#concurrent-collections" class="hash-link" aria-label="Direct link to Concurrent Collections" title="Direct link to Concurrent Collections">​</a></h4>
<p><strong>Java 5</strong></p>
<ul>
<li>ConcurrentHashMap instead of synchronizedMap (with operations put-if-absent, conditional remove, replace)</li>
<li>CopyOnWriteArrayList instead of synchronizedList</li>
<li>CopyOnWriteArraySet instead of synchronizedSet</li>
<li>Queue &amp; BlockingQueue along with ConcurrentLinkedQueue</li>
<li>PriorityQueue (non concurrent)</li>
</ul>
<p><strong>Java 6</strong></p>
<ul>
<li>ConcurrentSkipListMap instead of synchronized TreeMap</li>
<li>ConcurrentSkipListSet instead of synchronized TreeSet</li>
</ul>
<p><strong>ConcurrentHashMap</strong></p>
<ul>
<li>Lock striping</li>
<li>Concurrent readers and writers, thus high throughput</li>
<li>Weakly consistent iterators instead of fail-fast</li>
<li>Weakly consistent size and isEmpty too</li>
<li>Cannot lock at client side using map object, because internally it uses different locks</li>
<li>Due to above reason, we cannot exclusively lock map and thus cannot write our own put-if-absent</li>
<li>Thus this map provides such operations put-if-absent, conditional remove, replace</li>
</ul>
<p><strong>CopyOnWriteArrayList &amp; CopyOnWriteArraySet</strong></p>
<ul>
<li>Do not throw ConcurrentModificationException</li>
<li>Copy underlying data during, modification</li>
<li>No locking needed during iteration</li>
</ul>
<p><strong>Other classes</strong></p>
<ul>
<li>ArrayBlockingQueue &amp; LinkedBlockingQueue</li>
<li>SynchronousQueue</li>
<li>ArrayDeque &amp; LinkedBlockingDeque (work stealing: each consumer has its own deque and it steals from other consumer&#x27;s deque&#x27;s tail if its own is empty)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="interruptedexception">InterruptedException<a href="#interruptedexception" class="hash-link" aria-label="Direct link to InterruptedException" title="Direct link to InterruptedException">​</a></h4>
<ul>
<li>Threads waiting in blocked state can be interrupted, using interrupt method. It has boolean flag for setting this.</li>
<li>Good for cancelling long waiting tasks.</li>
<li>If your code calls method which throws InterruptedException then:</li>
<li>Choice 1 - Throw InterruptedException when called</li>
<li>Choice 2 - Catch it, and restore the interrupted flag</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="synchronizers">Synchronizers<a href="#synchronizers" class="hash-link" aria-label="Direct link to Synchronizers" title="Direct link to Synchronizers">​</a></h4>
<ul>
<li>
<p>Latches</p>
<ul>
<li>Can act as a gate, where all threads stop at the gate, and allowed once gate is opened.</li>
<li>This binary closed-open action is good for implementing &#x27;Resource is initialized, now dependent actions can begin&#x27;</li>
<li>Eg: Wait for all dependent services to init, wait for all players to arrive, wait until all worker threads finish etc.</li>
<li>CountDownLatch: await method, thread waits till count decrements to zero, or is interrupted or wait times out</li>
<li>FutureTask can also act as latch. future.get() method waits until task is completed and returns results.</li>
</ul>
</li>
<li>
<p>Semaphores</p>
<ul>
<li>Permits (acquire and release)</li>
<li>Useful in creating bounded collections</li>
<li>Can instead use BlockingQueue, if resources themselves are to be tracked. Eg: Object pool</li>
</ul>
</li>
<li>
<p>Barriers</p>
<ul>
<li>Similar to Latches with key difference</li>
<li>Latches are waiting for events, barriers are waiting for other threads</li>
<li>CyclicBarrier waits for fixed number of threads arrive at a point, repeatedly.</li>
<li>If all threads reach barrier point, barrier is passed and it resets.</li>
<li>await call returns arrival index to each thread, which can be used to &quot;elect&quot;</li>
<li>CyclicBarrier constructor accepts count (of threads) and Runnable (to run when threads reach this point).</li>
<li>Excellent for assigning sub-problems to threads and merging all results when barrier is reached.</li>
</ul>
</li>
<li>
<p>Exchanger</p>
<ul>
<li>Similar to Barrier that both wait until other arrives at same point.</li>
<li>Once reached they can exchange an object.</li>
<li>This is transfer of ownership of object (safe publication)</li>
<li>Example: Consumer exchanging an empty buffer with the producer, for a full buffer.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-execution">Task Execution<a href="#task-execution" class="hash-link" aria-label="Direct link to Task Execution" title="Direct link to Task Execution">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="thread-pools">Thread Pools<a href="#thread-pools" class="hash-link" aria-label="Direct link to Thread Pools" title="Direct link to Thread Pools">​</a></h4>
<p>Threadpool with its bounded pool helps throttle the inputs/requests so as to not exhaust available resources.</p>
<p>Single Threaded Executors provide synchronization guarantee that writes made by a task will be visible to subsequent tasks.</p>
<p><strong>Types</strong></p>
<ul>
<li>newFixedSizeThreadPool - creates new thread, if one dies due to exception</li>
<li>newCachedThreadPool - keeps increasing threads</li>
<li>newSingleThreadExecutor - consumes task based on queue type (FIFO, LIFO, Priority etc), resurrects thread if dead</li>
<li>newScheduledThreadPool - supports delayed and periodic execution similar to Timer</li>
</ul>
<p>Usually shutdown call is immediately followed by awaitTermination.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="uncaught-exception-handlers">Uncaught exception handlers<a href="#uncaught-exception-handlers" class="hash-link" aria-label="Direct link to Uncaught exception handlers" title="Direct link to Uncaught exception handlers">​</a></h4>
<p>Thread provides facility for UncaughtExceptionHandler. When thread dies due to some exception, JVM checks if it has exception handler, if not it checks its ThreadGroup, if not then its super ThreadGroup and so on. Final system level ThreadGroup just prints stack trace to System.err</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="shutdown-hooks">Shutdown hooks<a href="#shutdown-hooks" class="hash-link" aria-label="Direct link to Shutdown hooks" title="Direct link to Shutdown hooks">​</a></h4>
<ul>
<li>JVM also provides Runtime.addShutdownHook for when it attempts to shut down.</li>
<li>Then it runs finalizers if runFinalizerOnExit is true</li>
<li>It does not attempt to shutdown application threads, they die abruptly</li>
<li>If these hooks do not complete, they hang the JVM. Thus do proper synchronization and not dead lock them.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="daemon-threads">Daemon threads<a href="#daemon-threads" class="hash-link" aria-label="Direct link to Daemon threads" title="Direct link to Daemon threads">​</a></h4>
<ul>
<li>Daemon threads do not stop JVM to shutdown</li>
<li>GC, housekeeping threads are daemon threads</li>
<li>Threads inherit daemon status of the owner thread</li>
<li>When JVM halts, they do not call finally for daemon, nor cleanup their stacks, nor call finalizers.</li>
<li>Thus better to use them sparingly</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="finalizers">Finalizers<a href="#finalizers" class="hash-link" aria-label="Direct link to Finalizers" title="Direct link to Finalizers">​</a></h4>
<ul>
<li>Opportunity given by JVM to reclaim/free any resources being held up</li>
<li>Not guaranteed to run</li>
<li>Avoid as much as possible, catch-finally can more often do better job</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="applying-thread-pools">Applying Thread Pools<a href="#applying-thread-pools" class="hash-link" aria-label="Direct link to Applying Thread Pools" title="Direct link to Applying Thread Pools">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="thread-pool-sizes">Thread pool sizes<a href="#thread-pool-sizes" class="hash-link" aria-label="Direct link to Thread pool sizes" title="Direct link to Thread pool sizes">​</a></h4>
<ul>
<li>If its too big, it can exhaust memory (&amp; lot of overhead of creating/managing them)</li>
<li>If its too small, not completely utilizing the CPU</li>
<li>Usually, N (number of CPU cores) is right size of pools</li>
<li>Though, if tasks do IO then, not all threads will be schedulable (tasks will be waiting for some resource), so its okay to increase size of threadpool.</li>
<li>int N_CPUS = Runtime.getRuntime().availableProcessors();</li>
<li>Other deciding factors: memory, file handles, socket handles, and database connections</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="threadpoolexecutor">ThreadPoolExecutor<a href="#threadpoolexecutor" class="hash-link" aria-label="Direct link to ThreadPoolExecutor" title="Direct link to ThreadPoolExecutor">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="threads">Threads<a href="#threads" class="hash-link" aria-label="Direct link to Threads" title="Direct link to Threads">​</a></h4>
<ul>
<li>newFixedThreadPool: corePoolSize == maximumPoolSize</li>
<li>newCachedThreadPool: corePoolSize = 0 and maximumPoolSize = Integer.MAX_VALUE</li>
<li>Keep alive: how long to wait before unused thread is reclaimed (trade off)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="task-queues">Task Queues<a href="#task-queues" class="hash-link" aria-label="Direct link to Task Queues" title="Direct link to Task Queues">​</a></h4>
<ul>
<li>newFixedThreadPool and newSingleThreadedExecutor use unbounded LinkedBlockingQueue</li>
<li>Try to use bounded (LinkedBlockingQueue, ArrayBlockingQueue or PriorityQueue)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="saturation-policy">Saturation Policy<a href="#saturation-policy" class="hash-link" aria-label="Direct link to Saturation Policy" title="Direct link to Saturation Policy">​</a></h4>
<ul>
<li>When bounded queue is full, what to do when task is submitted</li>
<li>Abort - throw RejectedExecutionException</li>
<li>Discard - discard silently</li>
<li>Discard oldest - discards oldest from queue</li>
<li>Caller Runs - return task to caller, so that caller thread can run it instead</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="thread-factory">Thread Factory<a href="#thread-factory" class="hash-link" aria-label="Direct link to Thread Factory" title="Direct link to Thread Factory">​</a></h4>
<ul>
<li>Used to create new threads</li>
<li>By default new non-daemon threads are created</li>
<li>Can be overridden to create special threads which do say logging</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoiding-liveness-hazards">Avoiding Liveness Hazards<a href="#avoiding-liveness-hazards" class="hash-link" aria-label="Direct link to Avoiding Liveness Hazards" title="Direct link to Avoiding Liveness Hazards">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deadlocks">Deadlocks<a href="#deadlocks" class="hash-link" aria-label="Direct link to Deadlocks" title="Direct link to Deadlocks">​</a></h4>
<ul>
<li>Database systems are great at handling deadlocks; they back-off certain transactions such that locks are released.</li>
<li>JVM is not so kind. When threads are deadlocked, that&#x27;s it, game over.</li>
</ul>
<p>Transfer money is classic examples (with synchronized block on from and to accounts). If 2 calls are made, where 1st case arguments are from then to, and in 2nd case, its to then from. They may deadlock. To solve, either get comparable int keys or System.identityHashcode(), and order which account to be synchronized first. So no matter what&#x27;s order of arguments, you always lock same account first, avoiding deadlock.</p>
<p><strong>How to avoid</strong></p>
<ul>
<li>Use only 1 locks (so no ordering issues)</li>
<li>Order locks if multiple (ensure ordering is same no matter order of arguments)</li>
<li>Use tryLock method of lock classes</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="starvation-and-livelock">Starvation and LiveLock<a href="#starvation-and-livelock" class="hash-link" aria-label="Direct link to Starvation and LiveLock" title="Direct link to Starvation and LiveLock">​</a></h4>
<ul>
<li>Starvation is when thread is stuck</li>
<li>Livelock is when thread keeps running (eg: message listener throws exception, rolls back then again tries processing of same object)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-and-scalability">Performance and Scalability<a href="#performance-and-scalability" class="hash-link" aria-label="Direct link to Performance and Scalability" title="Direct link to Performance and Scalability">​</a></h3>
<p>Amdhal&#x27;s law - How much a  program can be theoretically sped up.</p>
<p>Trick is to divide into multiple tasks with their own data structures, and converge the results (this last step will be only step that will be sequential)</p>
<p>ConcurrentLinkedQueue is twice as fast as synchronizedLinkedList, because former has only final pointer updates as sequential while latter synchronizes on whole list.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="costs-on-performance">Costs on performance<a href="#costs-on-performance" class="hash-link" aria-label="Direct link to Costs on performance" title="Direct link to Costs on performance">​</a></h4>
<ul>
<li>Context switching</li>
<li>Synchronization</li>
<li>Data locality (memory cache)</li>
<li>Blocking on locks</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a href="#steps" class="hash-link" aria-label="Direct link to Steps" title="Direct link to Steps">​</a></h4>
<ul>
<li>Reduce lock contention</li>
<li>Reduce scope - get in / get out</li>
<li>Reduce lock granularity (too many times in and out is not good too)</li>
<li>Lock striping</li>
<li>Avoid hot fields</li>
<li>Non blocking (compare-and-swap)</li>
<li>Say no to object pooling - Java is super fast at new allocation, but getting objects from pool requires synchronization</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="explicit-locks">Explicit Locks<a href="#explicit-locks" class="hash-link" aria-label="Direct link to Explicit Locks" title="Direct link to Explicit Locks">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="lock-and-reentrantlock">Lock and ReentrantLock<a href="#lock-and-reentrantlock" class="hash-link" aria-label="Direct link to Lock and ReentrantLock" title="Direct link to Lock and ReentrantLock">​</a></h4>
<p>Lock implementations must provide the same memory-visibility semantics as intrinsic locks, but can differ in their locking semantics, scheduling algorithms, ordering guarantees, and performance characteristics.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-of-lock-classes">Advantages of lock classes<a href="#advantages-of-lock-classes" class="hash-link" aria-label="Direct link to Advantages of lock classes" title="Direct link to Advantages of lock classes">​</a></h4>
<ul>
<li>More flexible. Need not release lock in same block of code unlike synchronized</li>
<li>&quot;Synchronized block&quot; threads cannot be interrupted while they are waiting for lock.</li>
<li>lockInterruptibly can stop waiting for lock on interrupt</li>
<li>Deadlock can be avoided by trying to acquire lock, and releasing already acquired, if cannot acquire new one.</li>
<li>Intrinsic locks can&#x27;t release locks on timeout</li>
<li>Since Java 6, performance of intrinsic and reentrant lock is very similar. Earlier it used to be slower.</li>
</ul>
<p>Always do lock.unlock in finally block</p>
<p>Locks can be fair/unfair. Fair locks implement queues to handle requests for a lock. Ofcourse, fairness comes with cost of performance.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="read-write-lock">Read-Write lock<a href="#read-write-lock" class="hash-link" aria-label="Direct link to Read-Write lock" title="Direct link to Read-Write lock">​</a></h4>
<ul>
<li>Allows multiple concurrent readers, but only single writer</li>
<li>Great for data structure with lot of reads</li>
<li>More complex to implement thus slightly slower than reentrant lock</li>
</ul>
<p><strong>Implementation factors</strong></p>
<ul>
<li>Release preference - If writer is running, and readers+writers are waiting, preference to writer?</li>
<li>Reader barging - If reader is running, and readers+writers are waiting, preference to reader? Good for throughput but writer can become starved</li>
<li>Reentrancy - Are they reentrant</li>
<li>Downgrading - what if writer lock owners wants only reader lock</li>
<li>Upgrading - What if reader lock owner also wants writer lock</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="custom-synchronizer">Custom Synchronizer<a href="#custom-synchronizer" class="hash-link" aria-label="Direct link to Custom Synchronizer" title="Direct link to Custom Synchronizer">​</a></h4>
<p>Conditional queues - Threads waiting for an object lock which reflects certain condition.</p>
<p>Explicit class called Condition for implementing conditional queues (which can be implemented using intrinsic locks too).</p>
<p>Condition is associated with single lock. Lock.newCondition()</p>
<p><strong>Advantages</strong></p>
<ul>
<li>Fairness in wait</li>
<li>Timeout facility (flexibility)</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/engilyin/kb/docs/Job/TechInterview/Java/core/concurrency.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-10-03T16:28:54.000Z" itemprop="dateModified">Oct 3, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/kb/Job/TechInterview/Java/core/collections"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">collections</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kb/Job/TechInterview/Java/core/core-java"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">core-java</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#concurrency" class="table-of-contents__link toc-highlight">Concurrency</a><ul><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of Contents</a></li><li><a href="#basics" class="table-of-contents__link toc-highlight">Basics</a></li><li><a href="#sharing-objects" class="table-of-contents__link toc-highlight">Sharing Objects</a></li><li><a href="#composing-objects" class="table-of-contents__link toc-highlight">Composing Objects</a></li><li><a href="#building-blocks" class="table-of-contents__link toc-highlight">Building Blocks</a></li><li><a href="#task-execution" class="table-of-contents__link toc-highlight">Task Execution</a></li><li><a href="#applying-thread-pools" class="table-of-contents__link toc-highlight">Applying Thread Pools</a></li><li><a href="#avoiding-liveness-hazards" class="table-of-contents__link toc-highlight">Avoiding Liveness Hazards</a></li><li><a href="#performance-and-scalability" class="table-of-contents__link toc-highlight">Performance and Scalability</a></li><li><a href="#explicit-locks" class="table-of-contents__link toc-highlight">Explicit Locks</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Alex Ilin. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>